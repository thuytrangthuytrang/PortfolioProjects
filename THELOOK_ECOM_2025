--1.Thống kê tổng số lượng người mua và số lượng đơn hàng, giá trị đơn hàng trung bình đã hoàn thành mỗi tháng ( Từ 1/2024-9/2025).--

select 
 format_date('%Y-%m', t1.created_at) AS month,
 count(distinct t1.user_id)  as total_user, count(t1.id) as total_order,
 round(sum(t1.sale_price * t2.num_of_item),2) as revenue,
 round(sum (t3.cost),2) as cost, 
 round(sum(t1.sale_price) - sum (t3.cost),2) as profit,
 round(sum(t1.sale_price * t2.num_of_item)/count( distinct t1.id),2) as  average_order_value
from bigquery-public-data.thelook_ecommerce.order_items as t1
  join bigquery-public-data.thelook_ecommerce.orders as t2
      on t1.order_id = t2.order_id
  join bigquery-public-data.thelook_ecommerce.products as t3
  on t1.product_id=t3.id
where 
 t1.status='Complete'and
 format_date('%Y-%m', t1.created_at) between '2024-01' and '2025-09'
group by month
order by month
